
<p-table #dt [value]="orderItems" dataKey="Commodity" autoLayout="true" [expandedRowKeys]="expandedRows" class="table-test" [responsive]="true">
  <ng-template pTemplate="caption">
    <div style="text-align: right">
      <i class="fa fa-search" style="margin:4px 4px 0 0"></i>
      <input type="text" pInputText placeholder="Product Name" (input)="filterProducts($event.target.value, 'contains')">
    </div>
  </ng-template>
  <ng-template pTemplate="header">
    <tr>
      <th>
        Commodity
      </th>
      <th *ngIf="orderModel.IsEditable">
        Favorite
      </th>
      <th>
        Product Name
      </th>
      <th *ngIf="orderModel.IsEditable">
        Qty Min
      </th>
      <th *ngIf="orderModel.IsEditable">
        Increment
      </th>
      <th>
        Qty.
      </th>
      <th>
        Premium
      </th>
      <th *ngIf="orderModel.IsEditable">
        Tiers
      </th>
      <th>
        Oz.
      </th>
      <th>
        Unit Price
      </th>
      <th>
        Total
      </th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex" let-expanded="expanded" let-columns="columns">
    <tr class="ui-widget-header" *ngIf="rowGroupMetadata[rowData.Commodity].index === rowIndex">
      <td colspan="11">
        <a href="#" [pRowToggler]="rowData">
          <i (click)="onCommodityClicked(rowIndex,rowData.Commodity,$event)" [ngClass]="groupState[rowData.Commodity].expanded ? 'fa fa-fw fa-chevron-circle-down' : 'fa fa-fw fa-chevron-circle-right'"></i>
          <span (click)="onCommodityClicked(rowIndex,rowData.Commodity,$event)">{{rowData.Commodity}}</span>
        </a>
      </td>
    </tr>
  </ng-template>

  <ng-template pTemplate="rowexpansion" let-rowData let-rowIndex="rowIndex">
    <tr *ngIf="groupState[rowData.Commodity].expanded || rowData.Quantity > 0" [ngClass]="{'tr-quantity-entered':rowData.Quantity > 0}">
      <td style="text-align:center"><span *ngIf="rowData.IsNew" style="color:cornflowerblue;font-size:25px">*</span></td>
      <td *ngIf="orderModel.IsEditable">
        <span class="ui-column-title">{{cols[1].header}}</span>
        <ui-switch [(ngModel)]="rowData.IsFavorite" [disabled]="rowData.IsDisabled == true" (ngModelChange)="favSelectionChange(rowData)"></ui-switch>

      </td>
      <td>
        <span class="ui-column-title">{{cols[2].header}}</span>
        {{rowData.ProductDesc}}
        <div class="message-error">
          <ul>
            <li *ngFor="let warning of rowData.Warnings">warning</li>
          </ul>
          <span class="errorLabel">{{rowData.ErrorMsg}}</span>
        </div>
      </td>
      <td *ngIf="orderModel.IsEditable">
        <span class="ui-column-title">{{cols[3].header}}</span>
        {{rowData.MinPurchase}}
      </td>
      <td *ngIf="orderModel.IsEditable">
        <span class="ui-column-title">{{cols[4].header}}</span>
        {{rowData.PurchaseIncrement | number : '.5-5'}}
      </td>
      <td *ngIf="orderModel.IsEditable">
        <span class="ui-column-title">{{cols[5].header}}</span>
        <input type="text" [(ngModel)]="rowData.Quantity" (blur)="validateQuantity(rowIndex)" style="max-width:60px;text-align:right" />
     </td>
      <td *ngIf="!orderModel.IsEditable">
        <span class="ui-column-title">{{cols[5].header}}</span>
        <span>{{rowData.Quantity}}</span>

      </td>
      <td *ngIf="!rowData.PremiumIsPercent" [ngClass]="{'setParens': rowData.ProductPremium < 0}">
        <span class="ui-column-title">{{cols[6].header}}</span>
        {{ displayAbs(rowData.ProductPremium) | currency : 'USD' }}
      </td>
      <td *ngIf="rowData.PremiumIsPercent">
        <span class="ui-column-title">{{cols[6].header}}</span>
        {{ rowData.ProductPremium}}%
      </td>
      <ng-template #popTemplate><div [innerHtml]="rowData.TierPrices"></div></ng-template>
      <td *ngIf="orderModel.IsEditable">
        <span class="ui-column-title">{{cols[7].header}}</span>
        <a *ngIf="rowData.TierPrices" href="#" [tooltip]="popTemplate" placement="right" containerClass="tierprice-tooltip">
          View
        </a>
      </td>
      <td>
        <span class="ui-column-title">{{cols[8].header}}</span>
        {{ rowData.WeightSubTotal | number : '.5-5' }}
      </td>
      <td>
        <span class="ui-column-title">{{cols[9].header}}</span>
        {{ rowData.UnitPrice | currency : 'USD'}}
      </td>
      <td>
        <span class="ui-column-title">{{cols[10].header}}</span>
        {{ rowData.SubTotal | currency : 'USD'  }}
      </td>
    </tr>
  </ng-template>
  <ng-template pTemplate="summary">
    <div style="text-align:left">
      <span style="color:cornflowerblue;font-size:25px">*</span>
      <span style="margin-right:1.25em;font-size:12px;line-height:2.5em;vertical-align:middle;padding-bottom:10px;padding-left:5px;display:inline-block;">&nbsp;New Products</span>
    </div>
  </ng-template>
</p-table>
